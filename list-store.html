<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Alla butiker</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #fdfdfc; }
    h1 { color: #333; }

    .store-card {
      border: 1px solid #ddd;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .store-card h2 {
      margin: 0;
      font-size: 1.3rem;
    }

    .store-card h2 a {
      color: #b8860b; /* guld */
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .store-card h2 a:hover {
      color: #daa520; /* lite ljusare guld */
      text-decoration: underline;
    }

    .store-card p {
      margin: 0.3rem 0;
      color: #444;
    }

    .store-card a.external {
      color: #0077cc;
      text-decoration: none;
    }
    .store-card a.external:hover {
      text-decoration: underline;
    }

    .rating {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Alla butiker</h1>
  <div id="storeList">Laddar...</div>

<script>
  // üîë Din Supabase-info
  const supabaseUrl = "DIN_SUPABASE_URL";
  const supabaseKey = "DIN_SUPABASE_ANON_KEY";
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  async function loadStores() {
    // 1. H√§mta alla butiker
    const { data: stores, error: storeError } = await supabaseClient
      .from("stores")
      .select("*");

    if (storeError) {
      document.getElementById("storeList").textContent =
        "Kunde inte ladda butiker: " + storeError.message;
      return;
    }

    // 2. H√§mta summeringar (alla p√• en g√•ng)
    const { data: summaries, error: summaryError } = await supabaseClient
      .from("store_ratings_summary")
      .select("*");

    if (summaryError) {
      document.getElementById("storeList").textContent =
        "Kunde inte ladda betyg: " + summaryError.message;
      return;
    }

    // 3. Sl√• ihop butiker + summeringar
    const listDiv = document.getElementById("storeList");
    listDiv.innerHTML = "";
    stores.forEach(store => {
      const summary = summaries.find(s => s.store_id === store.id);
      const card = document.createElement("div");
      card.className = "store-card";

      const title = document.createElement("h2");
      const titleLink = document.createElement("a");
      titleLink.href = `store.html?store=${store.id}`;
      titleLink.textContent = store.name;
      title.appendChild(titleLink);
      card.appendChild(title);

      const addr = document.createElement("p");
      addr.textContent = store.address || "";
      card.appendChild(addr);

      if (store.link) {
        const link = document.createElement("a");
        link.href = store.link;
        link.textContent = "Bes√∂k hemsida";
        link.target = "_blank";
        link.className = "external";
        card.appendChild(link);
      }

      const rating = document.createElement("div");
      rating.className = "rating";
      if (summary) {
        rating.textContent =
          `‚≠ê ${summary.average_rating || 0} ( ${summary.total_ratings} r√∂ster, ${summary.total_reviews} recensioner )`;
      } else {
        rating.textContent = "‚≠ê Inga betyg √§n";
      }
      card.appendChild(rating);

      listDiv.appendChild(card);
    });
  }

  loadStores();
</script>
</body>
</html>
