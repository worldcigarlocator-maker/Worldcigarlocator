<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>World Cigar Locator â€“ City</title>
  <link rel="stylesheet" href="css/start.css?v=1" />
  <link rel="stylesheet" href="css/sidebar.css?v=1" />
  <link rel="stylesheet" href="css/global.css?v=1" />
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebarMenu">
    <div class="sidebar-search">
      <input type="text" id="sidebarSearch" placeholder="Search..." />
    </div>
    <ul id="continentList"><!-- Fylls av sidebar.js --></ul>
    <div class="sidebar-footer">
      <a href="add-store.html" class="btn-add">â• Add Store</a>
      <a href="mailto:support@worldcigarlocator.com" class="btn-support">ğŸ“§ Contact / Support</a>
    </div>
  </nav>

  <!-- Main -->
  <main class="page-main">
    <h1 id="city-title"></h1>
    <section id="store-list" class="store-grid">
      <!-- Butiker laddas hÃ¤r -->
    </section>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/sidebar.js?v=1"></script>
  <script>
    const supabase = window.supabase.createClient("https://YOUR-PROJECT.supabase.co", "YOUR-ANON-KEY");

    async function loadStores() {
      const urlParams = new URLSearchParams(window.location.search);
      const cityName = urlParams.get("city");
      document.getElementById("city-title").textContent = cityName;

      const { data: city } = await supabase.from("cities").select("id").eq("name", cityName).single();
      if (!city) return;

      const { data: stores } = await supabase
        .from("stores")
        .select("id, name, address, link")
        .eq("city_id", city.id);

      const list = document.getElementById("store-list");
      list.innerHTML = "";

      stores?.forEach(store => {
        const card = document.createElement("div");
        card.className = "store-card";
        card.innerHTML = `
          <h2><a href="store.html?id=${store.id}">${store.name}</a></h2>
          <p>${store.address || ""}</p>
          ${store.link ? `<a href="${store.link}" target="_blank">ğŸŒ Website</a>` : ""}
        `;
        list.appendChild(card);
      });
    }

    loadStores();
  </script>
</body>
</html>
