<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Backoffice ‚Äì Test 9</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{
  font-family:Arial, sans-serif;background:#f8f8f8;margin:0;padding:2rem;
}
h1{text-align:center;color:#b8860b;margin-bottom:1.5rem;}
.filter-bar{
  display:flex;justify-content:center;gap:1rem;margin-bottom:2rem;
}
.filter-bar button{
  border:none;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;
  background:#eee;font-weight:bold;
}
.filter-bar button.active{background:#b8860b;color:#fff;}
.grid{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:1.5rem;
}
.card{
  background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);
  overflow:hidden;display:flex;flex-direction:column;
}
.card img{width:100%;height:180px;object-fit:cover;}
.card-content{padding:1rem;flex:1;display:flex;flex-direction:column;justify-content:space-between;}
.card-type{
  display:inline-block;padding:0.2rem 0.6rem;border-radius:12px;
  font-size:0.8rem;color:#fff;font-weight:bold;text-transform:capitalize;
}
.card-type.store{background:#007bff;}
.card-type.lounge{background:#28a745;}
.card-type.other{background:#ff8c00;}
.status{
  float:right;padding:0.2rem 0.6rem;border-radius:8px;font-size:0.8rem;
  background:#dc3545;color:#fff;font-weight:bold;
}
.status.approved{background:#28a745;}
.status.flagged{background:#ff8c00;}
.card h2{margin:0.6rem 0 0.2rem;font-size:1.1rem;color:#333;}
.card p{margin:0.2rem 0;color:#555;}
.actions{
  display:flex;gap:0.5rem;margin-top:0.8rem;
}
.actions button{
  flex:1;padding:0.5rem;border:none;border-radius:6px;font-weight:bold;cursor:pointer;
}
.actions .approve{background:#28a745;color:#fff;}
.actions .delete{background:#dc3545;color:#fff;}
.rating{color:#b8860b;}
#toast-container{
  position:fixed;bottom:1rem;right:1rem;display:flex;flex-direction:column;gap:0.5rem;
}
.toast{
  background:#333;color:#fff;padding:0.8rem 1.2rem;border-radius:8px;opacity:0.95;
}
.toast.success{background:#28a745;}
.toast.error{background:#dc3545;}
</style>
</head>
<body>
<h1>Backoffice ‚Äì Test 9</h1>

<div class="filter-bar">
  <button class="active" data-filter="all">All</button>
  <button data-filter="approved">Approved</button>
  <button data-filter="pending">Pending</button>
  <button data-filter="flagged">Flagged</button>
</div>

<div id="grid" class="grid"></div>
<div id="toast-container"></div>

<script>
const supabaseUrl="https://gbxxoeplkzbhsvagnfsr.supabase.co";
const supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdieHhvZXBsa3piaHN2YWduZnNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NjQ1MDAsImV4cCI6MjA3MzI0MDUwMH0.E4Vk-GyLe22vyyfRy05hZtf4t5w_Bd_B-tkEFZ1alT4";
const supabase=window.supabase.createClient(supabaseUrl,supabaseKey);

const grid=document.getElementById("grid");

async function loadStores(filter="all"){
  let query=supabase.from("stores").select("*").order("created_at",{ascending:false});
  if(filter==="approved")query.eq("approved",true);
  if(filter==="pending")query.eq("approved",false);
  if(filter==="flagged")query.eq("flagged",true);
  const {data,error}=await query;
  if(error){console.error(error);showToast("Error loading data","error");return;}
  renderCards(data);
}

function renderCards(stores){
  grid.innerHTML="";
  stores.forEach(s=>{
    const card=document.createElement("div");
    card.className="card";

    // üñºÔ∏è Default-bild beroende p√• typ
    let img=s.photo_url;
    if(!img){
      if(s.type==="store")img="images/Store.png";
      else if(s.type==="lounge")img="images/Lounge.jpeg";
      else img="images/Cafe.jpg";
    }

    const stars=s.rating?("‚òÖ".repeat(s.rating)+"‚òÜ".repeat(5-s.rating)):"‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
    const statusClass=s.approved?"approved":s.flagged?"flagged":"pending";
    const statusLabel=s.approved?"Approved":s.flagged?"Flagged":"Pending";

    card.innerHTML=`
      <img src="${img}" alt="${s.name||"image"}">
      <div class="card-content">
        <div>
          <span class="card-type ${s.type}">${s.type||"other"}</span>
          <span class="status ${statusClass}">${statusLabel}</span>
          <h2>${s.name||"Unnamed"}</h2>
          <p>${s.address||""}</p>
          <p>${s.city||""}, ${s.country||""}</p>
          <p class="rating">${stars}</p>
          ${s.phone?`<p>üìû ${s.phone}</p>`:""}
          ${s.website?`<p><a href="${s.website}" target="_blank">üåê Website</a></p>`:""}
        </div>
        <div class="actions">
          <button class="approve">Approve</button>
          <button class="delete">Delete</button>
        </div>
      </div>
    `;
    const approveBtn=card.querySelector(".approve");
    const deleteBtn=card.querySelector(".delete");

    approveBtn.addEventListener("click",()=>approveStore(s.id));
    deleteBtn.addEventListener("click",()=>deleteStore(s.id));

    grid.appendChild(card);
  });
}

async function approveStore(id){
  const {error}=await supabase.from("stores").update({approved:true}).eq("id",id);
  if(error){console.error(error);showToast("Error approving","error");}
  else{showToast("Store approved!","success");loadStores(currentFilter);}
}

async function deleteStore(id){
  if(!confirm("Are you sure you want to delete this store?"))return;
  const {error}=await supabase.from("stores").delete().eq("id",id);
  if(error){console.error(error);showToast("Error deleting","error");}
  else{showToast("Store deleted","success");loadStores(currentFilter);}
}

function showToast(msg,type="success"){
  const div=document.createElement("div");
  div.className=`toast ${type}`;
  div.textContent=msg;
  document.getElementById("toast-container").appendChild(div);
  setTimeout(()=>div.remove(),3000);
}

let currentFilter="all";
document.querySelectorAll(".filter-bar button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".filter-bar button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter=btn.dataset.filter;
    loadStores(currentFilter);
  });
});

loadStores();
</script>
</body>
</html>
