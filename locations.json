import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

// ðŸ”‘ Din Supabase config
const SUPABASE_URL = "https://kvmifqqbpbkfalqlhaud.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2bWlmcXFicGJrZmFscWxoYXVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NzU3ODEsImV4cCI6MjA3MzQ1MTc4MX0.RCgl3Va7KGK21HP7sW_wueNWa5l17XMHnSXJ1aQA7gM";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const venuesDiv = document.getElementById("venues");

async function loadVenues() {
  const { data, error } = await supabase
    .from("venues")
    .select(`
      id, name, type, access, address, phone, email,
      cities ( name, regions ( name, countries ( name, continents ( name ) ) ) )
    `)
    .order("name", { ascending: true });

  if (error) {
    venuesDiv.innerHTML = "Error loading venues: " + error.message;
    return;
  }

  if (!data || data.length === 0) {
    venuesDiv.innerHTML = "No venues found yet.";
    return;
  }

  venuesDiv.innerHTML = "";
  data.forEach(v => {
    const div = document.createElement("div");
    div.className = "venue";

    const city = v.cities?.name || "Unknown city";
    const region = v.cities?.regions?.name || "";
    const country = v.cities?.regions?.countries?.name || "";
    const continent = v.cities?.regions?.countries?.continents?.name || "";

    div.innerHTML = `
      <h3>${v.name}</h3>
      <p><strong>Type:</strong> ${v.type}</p>
      <p><strong>Access:</strong> ${v.access}</p>
      <p><strong>Location:</strong> ${city}, ${region}, ${country} (${continent})</p>
      <p><strong>Address:</strong> ${v.address || "-"}</p>
      <p><strong>Phone:</strong> ${v.phone || "-"}</p>
      <p><strong>Email:</strong> ${v.email || "-"}</p>
    `;
    venuesDiv.appendChild(div);
  });
}

loadVenues();
