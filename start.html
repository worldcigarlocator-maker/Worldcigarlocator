<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Min sida</title>
  <style>
    body {
      margin: 0;
      display: flex;
      font-family: sans-serif;
    }

    #sidebar {
      width: 250px;
      background: #f8f9fa;
      border-right: 1px solid #ddd;
      padding: 1rem;
      height: 100vh;
      overflow-y: auto;
    }

    #main {
      flex: 1;
      padding: 2rem;
    }

    #sidebar ul {
      list-style: none;
      padding-left: 1rem;
    }

    #sidebar li {
      margin: 0.3rem 0;
      cursor: pointer;
      user-select: none;
    }

    .collapsed {
      display: none;
    }

    .arrow {
      font-size: 0.8rem;
      margin-right: 0.3rem;
    }
  </style>
</head>
<body>
  <!-- Sidomeny -->
  <div id="sidebar">
    <ul id="sidebarMenu"></ul>
  </div>

  <!-- Huvudinneh√•ll -->
  <div id="main">
    <h1>V√§lkommen</h1>
    <p>H√§r visas inneh√•ll n√§r du klickar p√• ett land.</p>
  </div>

  <!-- Supabase och script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // üîß Byt ut dessa mot dina egna fr√•n Supabase Project Settings ‚Üí API
    const SUPABASE_URL = "https://gbxxoeplkzbhsvagnfsr.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdieHhvZXBsa3piaHN2YWduZnNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NjQ1MDAsImV4cCI6MjA3MzI0MDUwMH0.E4Vk-GyLe22vyyfRy05hZtf4t5w_Bd_B-tkEFZ1alT4";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function buildSidebar() {
      const sidebar = document.getElementById("sidebarMenu");
      sidebar.innerHTML = "";

      // H√§mta kontinenter
      const { data: continents, error: err1 } = await supabase
        .from("continents")
        .select("id, name")
        .order("name");

      if (err1) {
        console.error("Fel vid h√§mtning av kontinenter:", err1);
        return;
      }

      // H√§mta l√§nder
      const { data: countries, error: err2 } = await supabase
        .from("countries")
        .select("id, name, flag, continent_id")
        .order("name");

      if (err2) {
        console.error("Fel vid h√§mtning av l√§nder:", err2);
        return;
      }

      // Bygg menyn
      continents.forEach(cont => {
        const contLi = document.createElement("li");

        // Pil f√∂r expand/collapse
        const arrow = document.createElement("span");
        arrow.textContent = "‚ñ∂"; // startl√§ge st√§ngd
        arrow.classList.add("arrow");

        const contName = document.createElement("span");
        contName.textContent = cont.name;

        contLi.appendChild(arrow);
        contLi.appendChild(contName);

        const countryUl = document.createElement("ul");
        countryUl.classList.add("collapsed");

        countries
          .filter(c => c.continent_id === cont.id)
          .forEach(c => {
            const countryLi = document.createElement("li");
            countryLi.textContent = `${c.flag || ""} ${c.name}`;
            countryUl.appendChild(countryLi);
          });

        contLi.appendChild(countryUl);

        // Toggle klick
        contLi.addEventListener("click", () => {
          countryUl.classList.toggle("collapsed");
          arrow.textContent = countryUl.classList.contains("collapsed") ? "‚ñ∂" : "‚ñº";
        });

        sidebar.appendChild(contLi);
      });
    }

    document.addEventListener("DOMContentLoaded", buildSidebar);
  </script>
</body>
</html>
