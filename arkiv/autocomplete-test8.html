<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test 8 ‚Äì Backoffice med bilder och filter</title>
  <style>
    body {font-family:Arial, sans-serif;background:#f6f6f6;margin:0;padding:2rem;}
    h1 {text-align:center;color:#b8860b;margin-bottom:1.5rem;}

    /* Filter-panel */
    .controls {display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;margin-bottom:1.5rem;}
    .controls input {padding:0.5rem 0.8rem;border:1px solid #ccc;border-radius:6px;}
    .controls button {padding:0.5rem 1rem;border:none;border-radius:6px;cursor:pointer;font-weight:bold;}
    .controls button.active {background:#b8860b;color:#fff;}

    /* Grid / Cards */
    .grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.5rem;max-width:1100px;margin:0 auto;}
    .card {background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);overflow:hidden;position:relative;}
    .card img {width:100%;height:160px;object-fit:cover;}
    .card-content {padding:1rem;}
    .badge {display:inline-block;padding:0.3rem 0.7rem;border-radius:12px;font-size:0.8rem;font-weight:bold;color:#fff;}
    .badge.store {background:#007bff;}
    .badge.lounge {background:#28a745;}
    .badge.other {background:#ff8c00;}
    .pending {position:absolute;top:8px;right:8px;background:#dc3545;color:#fff;font-size:0.7rem;
      padding:0.3rem 0.6rem;border-radius:6px;}
    h3 {margin:0.5rem 0;color:#333;}
    p {margin:0.2rem 0;color:#555;font-size:0.9rem;}
    .stars {color:#b8860b;margin-top:0.3rem;}
  </style>
</head>
<body>
  <h1>Backoffice Preview (Test 8)</h1>

  <!-- Filter / Search -->
  <div class="controls">
    <input type="text" id="search" placeholder="Search name or city‚Ä¶" />
    <button data-filter="all" class="active">All</button>
    <button data-filter="approved">Approved</button>
    <button data-filter="pending">Pending</button>
    <button data-filter="flagged">Flagged</button>
  </div>

  <div id="cards" class="grid"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = "https://gbxxoeplkzbhsvagnfsr.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdieHhvZXBsa3piaHN2YWduZnNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NjQ1MDAsImV4cCI6MjA3MzI0MDUwMH0.E4Vk-GyLe22vyyfRy05hZtf4t5w_Bd_B-tkEFZ1alT4";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let allStores = [];
    let currentFilter = "all";

    async function loadStores() {
      const { data, error } = await supabase.from("stores").select("*").order("created_at", { ascending: false });
      if (error) {console.error(error);return;}
      allStores = data;
      renderCards();
    }

    function renderCards() {
      const query = document.getElementById("search").value.toLowerCase();
      const filtered = allStores.filter(s => {
        if (currentFilter === "approved" && !s.approved) return false;
        if (currentFilter === "pending" && s.approved) return false;
        if (currentFilter === "flagged" && !s.flagged) return false;
        return (
          s.name?.toLowerCase().includes(query) ||
          s.city?.toLowerCase().includes(query)
        );
      });

      const container = document.getElementById("cards");
      container.innerHTML = "";

      filtered.forEach(store => {
        const div = document.createElement("div");
        div.className = "card";

        const stars = "‚òÖ".repeat(store.rating || 0) + "‚òÜ".repeat(5 - (store.rating || 0));
        const badgeClass = store.type || "other";
        const approved = store.approved === true;

        div.innerHTML = `
          ${store.photo_url ? `<img src="${store.photo_url}" alt="${store.name}">` : `<img src="images/placeholder.jpg" alt="No image">`}
          <div class="card-content">
            <span class="badge ${badgeClass}">${store.type || "Other"}</span>
            ${!approved ? `<span class="pending">Pending</span>` : ""}
            <h3>${store.name || "Unnamed"}</h3>
            <p>${store.address || ""}</p>
            <p>${store.city || ""}, ${store.country || ""}</p>
            <div class="stars">${stars}</div>
            ${store.phone ? `<p>üìû ${store.phone}</p>` : ""}
            ${store.website ? `<p><a href="${store.website}" target="_blank">üåê Website</a></p>` : ""}
          </div>
        `;
        container.appendChild(div);
      });
    }

    // Search
    document.getElementById("search").addEventListener("input", renderCards);

    // Filters
    document.querySelectorAll(".controls button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".controls button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        renderCards();
      });
    });

    document.addEventListener("DOMContentLoaded", loadStores);
  </script>
</body>
</html>
